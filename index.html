<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ä¸“æ³¨æ—¶é—´ç®¡ç†</title>
<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #0f0f1a, #1d253b);
    color: #fff;
  }
  header {
    padding: 20px;
    text-align: center;
    font-size: 32px;
    font-weight: bold;
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .container {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
  }
  .card {
    background: rgba(255,255,255,0.06);
    margin-top: 20px;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    backdrop-filter: blur(8px);
  }
  input, select {
    padding: 10px;
    border-radius: 10px;
    border: none;
    width: 100%;
    margin-top: 8px;
    margin-bottom: 15px;
  }
  button {
    padding: 12px 22px;
    background: #4e9cff;
    color: #fff;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #1f6fe0;
  }
  .task-item {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    margin: 5px 0;
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
  }
  audio {
    width: 100%;
    margin-top: 10px;
  }
</style>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDQkQFi2b0br4UemJP6Zhb-DckDx__pUs8",
  authDomain: "to-do-89a4f.firebaseapp.com",
  databaseURL: "https://to-do-89a4f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "to-do-89a4f",
  storageBucket: "to-do-89a4f.firebasestorage.app",
  messagingSenderId: "894992095532",
  appId: "1:894992095532:web:06fb10726bb2dc5c643489",
  measurementId: "G-W8BWH3WB50"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let username = "";
let timer = null;
let seconds = 0;

function login() {
  username = document.getElementById("username").value;
  if (!username) return alert("è¯·è¾“å…¥ç”¨æˆ·å");
  document.getElementById("loginSection").style.display = "none";
  document.getElementById("mainSection").style.display = "block";
}

function addTask() {
  const name = document.getElementById("taskName").value;
  const mode = document.getElementById("taskMode").value;
  const minutes = document.getElementById("taskMinutes").value;
  if (!name) return;
  const taskId = Date.now();
  db.ref(`users/${username}/tasks/${taskId}`).set({name, mode, minutes});
  renderTasks();
}

function deleteTask(id) {
  db.ref(`users/${username}/tasks/${id}`).remove();
  renderTasks();
}

function renderTasks() {
  const area = document.getElementById("taskList");
  area.innerHTML = "";
  db.ref(`users/${username}/tasks`).once("value", snap => {
    snap.forEach(child => {
      const t = child.val();
      area.innerHTML += `
      <div class='task-item'>
        <div>
          <strong>${t.name}</strong><br>
          ${t.mode} - ${t.minutes} åˆ†é’Ÿ
        </div>
        <button onclick="startTimer(${t.minutes*60})">å¼€å§‹</button>
        <button onclick="deleteTask('${child.key}')" style="background:#ff5c5c">åˆ é™¤</button>
      </div>`;
    });
  });
}

function startTimer(sec) {
  seconds = sec;
  clearInterval(timer);
  timer = setInterval(() => {
    seconds--;
    document.getElementById("timerDisplay").innerText = format(seconds);
    if (seconds <= 0) {
      clearInterval(timer);
      document.getElementById("endSound").play();
      saveFocusRecord();
    }
  }, 1000);
}

function saveFocusRecord() {
  const day = new Date().toISOString().slice(0,10);
  db.ref(`users/${username}/focus/${day}`).push({duration: seconds});
}

function format(sec) {
  let m = Math.floor(sec/60);
  let s = sec%60;
  return `${m}:${s.toString().padStart(2,'0')}`;
}
</script>
</head>
<body>
<header>ğŸ”¥ ä¸“ä¸šä¸“æ³¨æ—¶é—´ç®¡ç†ç³»ç»Ÿ</header>
<div class="container">

<div id="loginSection" class="card">
  <h2>ç™»å½•</h2>
  <input id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
  <button onclick="login()">è¿›å…¥ç³»ç»Ÿ</button>
</div>

<div id="mainSection" style="display:none;">
  <div class="card">
    <h2>æ·»åŠ ä»»åŠ¡</h2>
    <input id="taskName" placeholder="ä»»åŠ¡åç§°">
    <select id="taskMode">
      <option value="å€’è®¡æ—¶">å€’è®¡æ—¶</option>
      <option value="æ­£è®¡æ—¶">æ­£è®¡æ—¶</option>
    </select>
    <input id="taskMinutes" type="number" placeholder="åˆ†é’Ÿæ•°">
    <button onclick="addTask()">æ·»åŠ </button>
  </div>

  <div class="card">
    <h2>ä»»åŠ¡åˆ—è¡¨</h2>
    <div id="taskList"></div>
  </div>

  <div class="card" style="text-align:center;">
    <h2>è®¡æ—¶å™¨</h2>
    <h1 id="timerDisplay">0:00</h1>
  </div>

  <div class="card">
    <h2>ç™½å™ªéŸ³ä¸­å¿ƒ</h2>
    <select id="noiseSelect" onchange="changeNoise()">
      <option value="rain.mp3">é›¨å£°</option>
      <option value="forest.mp3">æ£®æ—</option>
      <option value="waves.mp3">æµ·æµª</option>
      <option value="wind.mp3">é£å£°</option>
      <option value="cafe.mp3">å’–å•¡åº—ç¯å¢ƒ</option>
    </select>
    <audio id="noisePlayer" controls loop></audio>
  </div>
</div>
</div>
<audio id="endSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<script>
function changeNoise(){
  const n = document.getElementById("noiseSelect").value;
  const p = document.getElementById("noisePlayer");
  p.src = n;
  p.play();
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶é—´ç®¡ç†ä¸ä¸“æ³¨åŠ›å·¥å…·</title>
    <!-- å¼•å…¥Chart.jsç”¨äºå›¾è¡¨ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¼•å…¥Font Awesomeå›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... ä¿æŒåŸæœ‰CSSæ ·å¼ä¸å˜ ... */
        
        /* æ–°å¢ç™½å™ªéŸ³æ’­æ”¾æ§åˆ¶æ ·å¼ */
        .noise-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .noise-control-btn {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .noise-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(106, 17, 203, 0.3);
        }
        
        .noise-control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .volume-slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 3px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #6a11cb;
            cursor: pointer;
        }
        
        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #6a11cb;
            cursor: pointer;
            border: none;
        }
        
        .volume-icon {
            font-size: 18px;
            color: #666;
        }
        
        .noise-playing {
            position: relative;
        }
        
        .noise-playing::after {
            content: "";
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background-color: #4CAF50;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(0.8); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ... HTMLä¸»ä½“éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œç›´åˆ°ç™½å™ªéŸ³éƒ¨åˆ† ... -->
    
    <div class="white-noise-section">
        <h3><i class="fas fa-volume-up"></i> ç™½å™ªéŸ³</h3>
        <p style="margin-bottom: 15px; color: #666;">é€‰æ‹©èƒŒæ™¯éŸ³æå‡ä¸“æ³¨åŠ›</p>
        <div class="white-noise">
            <div class="noise-option" data-sound="rain" data-src="https://assets.mixkit.co/sfx/preview/mixkit-rain-loop-1244.mp3">
                <div class="noise-icon">ğŸŒ§ï¸</div>
                <div>ä¸‹é›¨å£°</div>
            </div>
            <div class="noise-option" data-sound="forest" data-src="https://assets.mixkit.co/sfx/preview/mixkit-forest-birds-loop-1236.mp3">
                <div class="noise-icon">ğŸŒ²</div>
                <div>æ£®æ—é¸Ÿé¸£</div>
            </div>
            <div class="noise-option" data-sound="coffee" data-src="https://assets.mixkit.co/sfx/preview/mixkit-cafe-ambience-113.mp3">
                <div class="noise-icon">â˜•</div>
                <div>å’–å•¡é¦†</div>
            </div>
            <div class="noise-option" data-sound="waves" data-src="https://assets.mixkit.co/sfx/preview/mixkit-ocean-waves-loop-1234.mp3">
                <div class="noise-icon">ğŸŒŠ</div>
                <div>æµ·æµªå£°</div>
            </div>
            <div class="noise-option" data-sound="fireplace" data-src="https://assets.mixkit.co/sfx/preview/mixkit-campfire-crackling-1355.mp3">
                <div class="noise-icon">ğŸ”¥</div>
                <div>ç¯ç«å£°</div>
            </div>
            <div class="noise-option" data-sound="white-noise" data-src="https://assets.mixkit.co/sfx/preview/mixkit-white-noise-ambience-100.mp3">
                <div class="noise-icon">ğŸ“»</div>
                <div>ç™½å™ªéŸ³</div>
            </div>
        </div>
        
        <!-- æ–°å¢ï¼šéŸ³é‡æ§åˆ¶åŒºåŸŸ -->
        <div class="noise-controls">
            <button id="playNoiseBtn" class="noise-control-btn" disabled>
                <i class="fas fa-play"></i> æ’­æ”¾
            </button>
            <button id="stopNoiseBtn" class="noise-control-btn" disabled>
                <i class="fas fa-stop"></i> åœæ­¢
            </button>
            <button id="pauseNoiseBtn" class="noise-control-btn" disabled>
                <i class="fas fa-pause"></i> æš‚åœ
            </button>
        </div>
        
        <!-- æ–°å¢ï¼šéŸ³é‡æ»‘å— -->
        <div class="volume-control">
            <i class="fas fa-volume-down volume-icon"></i>
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50">
            <i class="fas fa-volume-up volume-icon"></i>
        </div>
        
        <p id="nowPlaying" style="margin-top: 10px; font-size: 12px; color: #666; text-align: center; min-height: 20px;">
            æœªæ’­æ”¾éŸ³é¢‘
        </p>
    </div>
    
    <!-- ... å‰©ä½™HTMLä»£ç ä¿æŒä¸å˜ ... -->

    <script>
        // åˆå§‹åŒ–å˜é‡
        let currentUser = null;
        let tasks = [];
        let currentTimer = null;
        let timerSeconds = 25 * 60;
        let timerRunning = false;
        let selectedSound = null;
        let currentAudioSrc = null;
        let focusSessions = [];
        
        // æ–°å¢ï¼šéŸ³é¢‘ç›¸å…³å˜é‡
        let audioPlayer = null;
        let isAudioPlaying = false;
        let audioContext = null;
        let audioGainNode = null;
        let currentVolume = 0.5;
        
        // æ–°å¢ï¼šéŸ³é¢‘èµ„æºURLæ˜ å°„
        const audioSources = {
            'rain': 'https://assets.mixkit.co/sfx/preview/mixkit-rain-loop-1244.mp3',
            'forest': 'https://assets.mixkit.co/sfx/preview/mixkit-forest-birds-loop-1236.mp3',
            'coffee': 'https://assets.mixkit.co/sfx/preview/mixkit-cafe-ambience-113.mp3',
            'waves': 'https://assets.mixkit.co/sfx/preview/mixkit-ocean-waves-loop-1234.mp3',
            'fireplace': 'https://assets.mixkit.co/sfx/preview/mixkit-campfire-crackling-1355.mp3',
            'white-noise': 'https://assets.mixkit.co/sfx/preview/mixkit-white-noise-ambience-100.mp3'
        };
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadFromLocalStorage() {
            const savedTasks = localStorage.getItem('focusTasks');
            const savedSessions = localStorage.getItem('focusSessions');
            const savedVolume = localStorage.getItem('audioVolume');
            const savedAudioType = localStorage.getItem('selectedAudioType');
            
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
            
            if (savedSessions) {
                focusSessions = JSON.parse(savedSessions);
            }
            
            if (savedVolume) {
                currentVolume = parseFloat(savedVolume);
                document.getElementById('volumeSlider').value = currentVolume * 100;
            }
            
            if (savedAudioType) {
                selectedSound = savedAudioType;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„ç”¨æˆ·ç™»å½•çŠ¶æ€
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }
        }
        
        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            localStorage.setItem('focusTasks', JSON.stringify(tasks));
            localStorage.setItem('focusSessions', JSON.stringify(focusSessions));
            localStorage.setItem('audioVolume', currentVolume.toString());
            
            if (selectedSound) {
                localStorage.setItem('selectedAudioType', selectedSound);
            }
            
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            } else {
                localStorage.removeItem('currentUser');
            }
        }
        
        // DOMå…ƒç´ 
        const loginPanel = document.getElementById('loginPanel');
        const mainApp = document.getElementById('mainApp');
        const userInfo = document.getElementById('userInfo');
        const userName = document.getElementById('userName');
        const userAvatar = document.getElementById('userAvatar');
        const usernameInput = document.getElementById('usernameInput');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const taskList = document.getElementById('taskList');
        const emptyTaskState = document.getElementById('emptyTaskState');
        const addTaskForm = document.getElementById('addTaskForm');
        const timerDisplay = document.getElementById('timerDisplay');
        const startTimerBtn = document.getElementById('startTimerBtn');
        const stopTimerBtn = document.getElementById('stopTimerBtn');
        const presetButtons = document.querySelectorAll('.preset-btn');
        const customMinutes = document.getElementById('customMinutes');
        const noiseOptions = document.querySelectorAll('.noise-option');
        const notification = document.getElementById('notification');
        
        // æ–°å¢ï¼šéŸ³é¢‘æ§åˆ¶DOMå…ƒç´ 
        const playNoiseBtn = document.getElementById('playNoiseBtn');
        const stopNoiseBtn = document.getElementById('stopNoiseBtn');
        const pauseNoiseBtn = document.getElementById('pauseNoiseBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const nowPlayingText = document.getElementById('nowPlaying');
        
        // å›¾è¡¨å˜é‡
        let dailyChart, weeklyChart, monthlyChart, taskDistributionChart;
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadFromLocalStorage();
            
            // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
            if (currentUser) {
                userName.textContent = currentUser.name;
                userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
                loginPanel.classList.add('hidden');
                mainApp.classList.remove('hidden');
                userInfo.classList.remove('hidden');
            }
            
            // åˆå§‹åŒ–å›¾è¡¨
            initializeCharts();
            
            // äº‹ä»¶ç›‘å¬
            loginBtn.addEventListener('click', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            addTaskForm.addEventListener('submit', handleAddTask);
            startTimerBtn.addEventListener('click', startTimer);
            stopTimerBtn.addEventListener('click', stopTimer);
            customMinutes.addEventListener('change', updateTimerDisplay);
            
            // é¢„è®¾æŒ‰é’®äº‹ä»¶
            presetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    presetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const minutes = parseInt(this.getAttribute('data-minutes'));
                    customMinutes.value = minutes;
                    updateTimerDisplay();
                });
            });
            
            // ç™½å™ªéŸ³é€‰é¡¹äº‹ä»¶
            noiseOptions.forEach(option => {
                option.addEventListener('click', function() {
                    noiseOptions.forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    
                    const soundType = this.getAttribute('data-sound');
                    const audioSrc = this.getAttribute('data-src');
                    selectedSound = soundType;
                    currentAudioSrc = audioSrc;
                    
                    // ä¿å­˜é€‰æ‹©çš„éŸ³é¢‘ç±»å‹
                    localStorage.setItem('selectedAudioType', soundType);
                    
                    // æ›´æ–°æ’­æ”¾æŒ‰é’®çŠ¶æ€
                    playNoiseBtn.disabled = false;
                    
                    // å¦‚æœéŸ³é¢‘æ­£åœ¨æ’­æ”¾ï¼Œåˆ‡æ¢åˆ°æ–°éŸ³é¢‘
                    if (isAudioPlaying && audioPlayer) {
                        stopAudio();
                        setTimeout(() => {
                            playAudio();
                        }, 100);
                    }
                    
                    showNotification(`å·²é€‰æ‹©: ${this.querySelector('div:last-child').textContent}`);
                    updateNowPlayingText();
                });
            });
            
            // æ–°å¢ï¼šéŸ³é¢‘æ§åˆ¶æŒ‰é’®äº‹ä»¶ç›‘å¬
            playNoiseBtn.addEventListener('click', playAudio);
            stopNoiseBtn.addEventListener('click', stopAudio);
            pauseNoiseBtn.addEventListener('click', pauseAudio);
            volumeSlider.addEventListener('input', updateVolume);
            
            // è®¾ç½®é»˜è®¤ç™½å™ªéŸ³
            if (selectedSound) {
                // æ¢å¤ä¸Šæ¬¡é€‰æ‹©çš„éŸ³é¢‘
                const selectedOption = document.querySelector(`.noise-option[data-sound="${selectedSound}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('active');
                    currentAudioSrc = selectedOption.getAttribute('data-src');
                    playNoiseBtn.disabled = false;
                } else {
                    // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
                    noiseOptions[0].classList.add('active');
                    selectedSound = noiseOptions[0].getAttribute('data-sound');
                    currentAudioSrc = noiseOptions[0].getAttribute('data-src');
                    playNoiseBtn.disabled = false;
                }
            } else {
                noiseOptions[0].classList.add('active');
                selectedSound = noiseOptions[0].getAttribute('data-sound');
                currentAudioSrc = noiseOptions[0].getAttribute('data-src');
                playNoiseBtn.disabled = false;
            }
            
            // è®¾ç½®åˆå§‹éŸ³é‡
            if (currentVolume !== 0.5) {
                volumeSlider.value = currentVolume * 100;
            }
            
            // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
            initializeAudioContext();
            
            // åˆå§‹æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            updateTimerDisplay();
            
            // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
            renderTaskList();
            
            // æ›´æ–°å½“å‰æ’­æ”¾æ–‡æœ¬
            updateNowPlayingText();
        });
        
        // æ–°å¢ï¼šåˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
        function initializeAudioContext() {
            try {
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒWeb Audio API
                if (window.AudioContext || window.webkitAudioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    audioGainNode = audioContext.createGain();
                    audioGainNode.connect(audioContext.destination);
                    audioGainNode.gain.value = currentVolume;
                    
                    console.log('éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    console.warn('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWeb Audio API');
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡å¤±è´¥:', error);
            }
        }
        
        // æ–°å¢ï¼šæ’­æ”¾éŸ³é¢‘
        function playAudio() {
            if (!currentAudioSrc) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ç§ç™½å™ªéŸ³', 'error');
                return;
            }
            
            if (isAudioPlaying) {
                // å¦‚æœå·²ç»åœ¨æ’­æ”¾ï¼Œæš‚åœ
                pauseAudio();
                return;
            }
            
            if (!audioPlayer) {
                audioPlayer = new Audio(currentAudioSrc);
                audioPlayer.loop = true;
                audioPlayer.preload = 'auto';
                
                // å¦‚æœéŸ³é¢‘ä¸Šä¸‹æ–‡å·²åˆå§‹åŒ–ï¼Œå°†éŸ³é¢‘è¿æ¥åˆ°éŸ³é¢‘ä¸Šä¸‹æ–‡
                if (audioContext && audioGainNode) {
                    const source = audioContext.createMediaElementSource(audioPlayer);
                    source.connect(audioGainNode);
                }
                
                audioPlayer.volume = currentVolume;
                
                audioPlayer.addEventListener('canplaythrough', function() {
                    console.log('éŸ³é¢‘å¯ä»¥æ’­æ”¾');
                });
                
                audioPlayer.addEventListener('error', function(e) {
                    console.error('éŸ³é¢‘åŠ è½½é”™è¯¯:', e);
                    showNotification('éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                    stopAudio();
                });
            }
            
            audioPlayer.play()
                .then(() => {
                    isAudioPlaying = true;
                    playNoiseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                    playNoiseBtn.disabled = false;
                    stopNoiseBtn.disabled = false;
                    pauseNoiseBtn.disabled = false;
                    
                    // æ·»åŠ æ’­æ”¾çŠ¶æ€æ ·å¼
                    const activeOption = document.querySelector('.noise-option.active');
                    if (activeOption) {
                        activeOption.classList.add('noise-playing');
                    }
                    
                    updateNowPlayingText();
                    showNotification('ç™½å™ªéŸ³æ’­æ”¾ä¸­', 'success');
                })
                .catch(error => {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                    showNotification('æ’­æ”¾å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        // æ–°å¢ï¼šæš‚åœéŸ³é¢‘
        function pauseAudio() {
            if (audioPlayer && isAudioPlaying) {
                audioPlayer.pause();
                isAudioPlaying = false;
                playNoiseBtn.innerHTML = '<i class="fas fa-play"></i> æ’­æ”¾';
                playNoiseBtn.disabled = false;
                
                // ç§»é™¤æ’­æ”¾çŠ¶æ€æ ·å¼
                const activeOption = document.querySelector('.noise-option.active');
                if (activeOption) {
                    activeOption.classList.remove('noise-playing');
                }
                
                updateNowPlayingText();
                showNotification('ç™½å™ªéŸ³å·²æš‚åœ', 'info');
            }
        }
        
        // æ–°å¢ï¼šåœæ­¢éŸ³é¢‘
        function stopAudio() {
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                audioPlayer = null;
                isAudioPlaying = false;
                playNoiseBtn.innerHTML = '<i class="fas fa-play"></i> æ’­æ”¾';
                playNoiseBtn.disabled = false;
                stopNoiseBtn.disabled = true;
                pauseNoiseBtn.disabled = true;
                
                // ç§»é™¤æ’­æ”¾çŠ¶æ€æ ·å¼
                const activeOption = document.querySelector('.noise-option.active');
                if (activeOption) {
                    activeOption.classList.remove('noise-playing');
                }
                
                updateNowPlayingText();
                showNotification('ç™½å™ªéŸ³å·²åœæ­¢', 'info');
            }
        }
        
        // æ–°å¢ï¼šæ›´æ–°éŸ³é‡
        function updateVolume() {
            const volumeValue = volumeSlider.value / 100;
            currentVolume = volumeValue;
            
            if (audioPlayer) {
                audioPlayer.volume = currentVolume;
            }
            
            if (audioGainNode) {
                audioGainNode.gain.value = currentVolume;
            }
            
            // ä¿å­˜éŸ³é‡è®¾ç½®
            localStorage.setItem('audioVolume', currentVolume.toString());
            
            // æ›´æ–°éŸ³é‡å›¾æ ‡
            const volumeIcons = document.querySelectorAll('.volume-icon');
            if (currentVolume === 0) {
                volumeIcons.forEach(icon => {
                    icon.className = 'fas fa-volume-mute volume-icon';
                });
            } else if (currentVolume < 0.5) {
                volumeIcons.forEach(icon => {
                    icon.className = 'fas fa-volume-down volume-icon';
                });
            } else {
                volumeIcons.forEach(icon => {
                    icon.className = 'fas fa-volume-up volume-icon';
                });
            }
        }
        
        // æ–°å¢ï¼šæ›´æ–°å½“å‰æ’­æ”¾æ–‡æœ¬
        function updateNowPlayingText() {
            if (!currentAudioSrc) {
                nowPlayingText.textContent = 'æœªé€‰æ‹©éŸ³é¢‘';
                return;
            }
            
            const activeOption = document.querySelector('.noise-option.active');
            if (!activeOption) {
                nowPlayingText.textContent = 'æœªé€‰æ‹©éŸ³é¢‘';
                return;
            }
            
            const soundName = activeOption.querySelector('div:last-child').textContent;
            
            if (isAudioPlaying) {
                nowPlayingText.innerHTML = `<i class="fas fa-volume-up" style="color:#4CAF50;"></i> æ­£åœ¨æ’­æ”¾: ${soundName} (éŸ³é‡: ${Math.round(currentVolume * 100)}%)`;
            } else if (audioPlayer && audioPlayer.currentTime > 0) {
                nowPlayingText.innerHTML = `<i class="fas fa-pause" style="color:#FF9800;"></i> å·²æš‚åœ: ${soundName}`;
            } else {
                nowPlayingText.innerHTML = `<i class="fas fa-stop" style="color:#666;"></i> å·²åœæ­¢: ${soundName}`;
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'success') {
                notification.style.backgroundColor = '#4CAF50';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#f44336';
            } else {
                notification.style.backgroundColor = '#2196F3';
            }
            
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }
        
        // å¤„ç†ç™»å½•
        function handleLogin() {
            const username = usernameInput.value.trim();
            if (!username) {
                showNotification('è¯·è¾“å…¥æ‚¨çš„åå­—', 'error');
                usernameInput.focus();
                return;
            }
            
            currentUser = {
                name: username,
                id: 'user-' + Date.now()
            };
            
            // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // æ›´æ–°UI
            userName.textContent = currentUser.name;
            userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
            
            // åˆ‡æ¢æ˜¾ç¤º
            loginPanel.classList.add('hidden');
            mainApp.classList.remove('hidden');
            userInfo.classList.remove('hidden');
            
            // å¯ç”¨éŸ³é¢‘æ’­æ”¾æŒ‰é’®
            playNoiseBtn.disabled = false;
            
            showNotification(`æ¬¢è¿å›æ¥ï¼Œ${currentUser.name}ï¼`, 'success');
            updateCharts();
        }
        
        // å¤„ç†é€€å‡ºç™»å½•
        function handleLogout() {
            // åœæ­¢è®¡æ—¶å™¨
            stopTimer();
            
            // åœæ­¢éŸ³é¢‘
            stopAudio();
            
            // é‡ç½®çŠ¶æ€
            currentUser = null;
            
            // æ¸…é™¤æœ¬åœ°å­˜å‚¨
            localStorage.removeItem('currentUser');
            
            // åˆ‡æ¢æ˜¾ç¤º
            loginPanel.classList.remove('hidden');
            mainApp.classList.add('hidden');
            userInfo.classList.add('hidden');
            
            // ç¦ç”¨éŸ³é¢‘æ’­æ”¾æŒ‰é’®
            playNoiseBtn.disabled = true;
            stopNoiseBtn.disabled = true;
            pauseNoiseBtn.disabled = true;
            
            usernameInput.value = '';
            showNotification('æ‚¨å·²é€€å‡ºç™»å½•', 'info');
        }
        
        // ... å…¶ä»–å‡½æ•°ä¿æŒä¸å˜ï¼ˆrenderTaskList, handleAddTask, startTimer, stopTimerç­‰ï¼‰...
        
        // åœ¨é¡µé¢å¸è½½å‰åœæ­¢éŸ³é¢‘
        window.addEventListener('beforeunload', function() {
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer = null;
            }
            
            if (audioContext) {
                audioContext.close();
            }
        });
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶å¤„ç†éŸ³é¢‘
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && audioPlayer && isAudioPlaying) {
                // é¡µé¢éšè—æ—¶æš‚åœéŸ³é¢‘
                audioPlayer.pause();
                const wasPlaying = isAudioPlaying;
                isAudioPlaying = false;
                
                // é¡µé¢é‡æ–°å¯è§æ—¶æ¢å¤æ’­æ”¾
                document.addEventListener('visibilitychange', function resumeAudio() {
                    if (!document.hidden && wasPlaying && audioPlayer) {
                        audioPlayer.play()
                            .then(() => {
                                isAudioPlaying = true;
                                playNoiseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                            })
                            .catch(error => {
                                console.error('æ¢å¤æ’­æ”¾å¤±è´¥:', error);
                            });
                        document.removeEventListener('visibilitychange', resumeAudio);
                    }
                });
            }
        });
        
        // ... å…¶ä½™çš„å‡½æ•°ä¿æŒä¸å˜ ...
    </script>
</body>
</html>
